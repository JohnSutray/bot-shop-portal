<mat-card class="product">
  <mat-card-header *ngIf="!isFormState else editableCardHeader">
    <mat-card-title> {{product.name}} </mat-card-title>
    <mat-card-subtitle> {{product.price}}р.</mat-card-subtitle>
  </mat-card-header>

  <ng-template #editableCardHeader>
    <mat-card-header>
      <mat-card-title>
        {{ isEditMode ? 'Изменить продукт' : 'Создать продукт' }}
      </mat-card-title>
    </mat-card-header>
  </ng-template>

  <img mat-card-image
       class="product__image"
       [src]="imageUrl"
       [alt]="nameControl.value">

  <mat-card-content *ngIf="!isFormState else editableCardContent">
    <p>Описание: {{ product.description }}</p>
    <p>Категория: {{ product.category }} </p>
    <p>Тип: {{ product.type }} </p>
  </mat-card-content>

  <ng-template #editableCardContent>
    <mat-card-content>
      <div class="flex-column">
        <button mat-raised-button
                color="accent"
                (click)="onSelectFileClick()">
          {{ isCreateMode && !imageFile ? 'Добавить' : 'Изменить' }} изображение
          <input class="display-none"
                 type="file"
                 accept="image/jpeg,image/png"
                 (input)="onFileSelect()"
                 #fileInput>
        </button>

        <p></p>

        <button *ngIf="imageFile && isEditMode"
                (click)="clearImage()"
                mat-raised-button
                color="accent">
          Вернуть изображение
        </button>

        <mat-form-field class="product__name-field">
          <input matInput
                 [formControl]="nameControl"
                 autocomplete="off"
                 maxlength="30"
                 placeholder="Имя">
          <mat-error *ngIf="nameControl.invalid">Вы должны ввести имя</mat-error>
          <mat-hint align="end">{{ nameControl.value.length }} / 30</mat-hint>
        </mat-form-field>

        <mat-form-field class="product__name-field">
          <input matInput
                 [formControl]="priceControl"
                 type="number"
                 autocomplete="off"
                 min="0"
                 placeholder="Цена">
          <span matSuffix>p.</span>
          <mat-error *ngIf="priceControl.invalid">Вы должны ввести цену</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline"
                        class="product__description-field">
          <mat-label>Описание</mat-label>
          <textarea matInput
                    [formControl]="descriptionControl"
                    rows="5"
                    maxlength="5000"
                    placeholder="Описание">
          </textarea>
          <mat-hint>{{ descriptionControl.value.length }} / 5000</mat-hint>
          <mat-error *ngIf="descriptionControl.invalid">Введите описание продукта</mat-error>
        </mat-form-field>

        <div class="product__organisation-settings-section flex-row">
          <mat-slide-toggle color="primary"
                            [(ngModel)]="isNewCategoryMode"
                            (change)="onNewCategoryModeChange()">
            Новая категория
          </mat-slide-toggle>

          <div class="flex-grow-1"></div>

          <mat-slide-toggle color="primary"
                            [(ngModel)]="isNewTypeMode"
                            [disabled]="isNewCategoryMode">
            Новый тип
          </mat-slide-toggle>
        </div>

        <mat-form-field *ngIf="!isNewCategoryMode else newCategoryField">
          <mat-label>Категория</mat-label>
          <mat-select [formControl]="categoryControl"
                      (selectionChange)="onCategorySelect()">
            <mat-option *ngFor="let category of categories"
                        [value]="category.name">
              {{ category.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <ng-template #newCategoryField>
          <mat-form-field>
            <mat-label>Категория</mat-label>
            <input matInput
                   [formControl]="categoryControl"
                   autocomplete="off"
                   placeholder="Категория">
          </mat-form-field>
        </ng-template>

        <mat-form-field *ngIf="!isNewTypeMode else newTypeField">
          <mat-label>Тип</mat-label>
          <mat-select [formControl]="typeControl">
            <mat-option *ngFor="let type of types"
                        [value]="type">
              {{ type }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <ng-template #newTypeField>
          <mat-form-field>
            <mat-label>Тип</mat-label>
            <input matInput
                   [formControl]="typeControl"
                   autocomplete="off"
                   placeholder="Категория">
          </mat-form-field>
        </ng-template>
      </div>
    </mat-card-content>
  </ng-template>

  <mat-card-actions *ngIf="!isFormState else editableCardActions">
    <button mat-raised-button
            color="accent"
            (click)="onEditClick()">
      Изменить
    </button>
    <button mat-raised-button
            (click)="removeProduct()"
            color="accent">
      Удалить
    </button>
  </mat-card-actions>

  <ng-template #editableCardActions>
    <mat-card-actions>
      <button mat-raised-button
              color="primary"
              [disabled]="invalidState"
              (click)="onChangesSubmit()">
        {{ isEditMode ? 'Обновить' : 'Создать' }}
      </button>

      <button mat-raised-button
              color="warn"
              *ngIf="isFormState"
              (click)="onCancel()">
        Отмена
      </button>
    </mat-card-actions>
  </ng-template>
</mat-card>
